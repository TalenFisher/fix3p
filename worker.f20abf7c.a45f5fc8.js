parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"Ofed":[function(require,module,exports) {
var define;
var r;parcelRequire=function(t,e,s,n){var i,a="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function h(r,s){if(!e[r]){if(!t[r]){var n="function"==typeof parcelRequire&&parcelRequire;if(!s&&n)return n(r,!0);if(a)return a(r,!0);if(o&&"string"==typeof r)return o(r);var i=new Error("Cannot find module '"+r+"'");throw i.code="MODULE_NOT_FOUND",i}p.resolve=function(e){return t[r][1][e]||e},p.cache={};var u=e[r]=new h.Module(r);t[r][0].call(u.exports,p,u,u.exports,this)}return e[r].exports;function p(r){return h(p.resolve(r))}}h.isParcelRequire=!0,h.Module=function(r){this.id=r,this.bundle=h,this.exports={}},h.modules=t,h.cache=e,h.parent=a,h.register=function(r,e){t[r]=[function(r,t){t.exports=e},{}]};for(var u=0;u<s.length;u++)try{h(s[u])}catch(t){i||(i=t)}if(s.length){var p=h(s[s.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof r&&r.amd?r(function(){return p}):this.X3P=p}if(parcelRequire=h,i)throw i;return h}({gm1b:[function(r,t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(r){return void 0===r&&(r=1),[[0,0],[0,r],[r,0],[r,r],[r,0],[0,r]]}},{}],oQJj:[function(r,t,e){t.exports=function(r){switch(r.toLowerCase()){case"int8":return Int8Array;case"i":case"int16":return Int16Array;case"l":case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"f":case"float32":return Float32Array;case"d":case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],YG3F:[function(r,t,e){"use strict";t.exports=function(r){for(var t=new Array(r),e=0;e<r;++e)t[e]=e;return t}},{}],qZlO:[function(r,t,e){function s(r){return!!r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}t.exports=function(r){return null!=r&&(s(r)||function(r){return"function"==typeof r.readFloatLE&&"function"==typeof r.slice&&s(r.slice(0,0))}(r)||!!r._isBuffer)}},{}],cMKA:[function(r,t,e){var s=r("iota-array"),n=r("is-buffer"),i="undefined"!=typeof Float64Array;function a(r,t){return r[0]-t[0]}function o(){var r,t=this.stride,e=new Array(t.length);for(r=0;r<e.length;++r)e[r]=[Math.abs(t[r]),r];e.sort(a);var s=new Array(e.length);for(r=0;r<s.length;++r)s[r]=e[r][1];return s}function h(r,t){var e=["View",t,"d",r].join("");t<0&&(e="View_Nil"+r);var n="generic"===r;if(-1===t){var i="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+r+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(i)()}if(0===t)return i="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+r+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}",new Function("TrivialArray",i)(p[r][0]);i=["'use strict'"];var a=s(t),h=a.map(function(r){return"i"+r}),u="this.offset+"+a.map(function(r){return"this.stride["+r+"]*i"+r}).join("+"),c=a.map(function(r){return"b"+r}).join(","),f=a.map(function(r){return"c"+r}).join(",");i.push("function "+e+"(a,"+c+","+f+",d){this.data=a","this.shape=["+c+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+r+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+a.map(function(r){return"this.shape["+r+"]"}).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+e+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+e+"_set("+h.join(",")+",v){"),n?i.push("return this.data.set("+u+",v)}"):i.push("return this.data["+u+"]=v}"),i.push("proto.get=function "+e+"_get("+h.join(",")+"){"),n?i.push("return this.data.get("+u+")}"):i.push("return this.data["+u+"]}"),i.push("proto.index=function "+e+"_index(",h.join(),"){return "+u+"}"),i.push("proto.hi=function "+e+"_hi("+h.join(",")+"){return new "+e+"(this.data,"+a.map(function(r){return["(typeof i",r,"!=='number'||i",r,"<0)?this.shape[",r,"]:i",r,"|0"].join("")}).join(",")+","+a.map(function(r){return"this.stride["+r+"]"}).join(",")+",this.offset)}");var l=a.map(function(r){return"a"+r+"=this.shape["+r+"]"}),d=a.map(function(r){return"c"+r+"=this.stride["+r+"]"});i.push("proto.lo=function "+e+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+d.join(","));for(var g=0;g<t;++g)i.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");for(i.push("return new "+e+"(this.data,"+a.map(function(r){return"a"+r}).join(",")+","+a.map(function(r){return"c"+r}).join(",")+",b)}"),i.push("proto.step=function "+e+"_step("+h.join(",")+"){var "+a.map(function(r){return"a"+r+"=this.shape["+r+"]"}).join(",")+","+a.map(function(r){return"b"+r+"=this.stride["+r+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),g=0;g<t;++g)i.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");i.push("return new "+e+"(this.data,"+a.map(function(r){return"a"+r}).join(",")+","+a.map(function(r){return"b"+r}).join(",")+",c)}");var y=new Array(t),v=new Array(t);for(g=0;g<t;++g)y[g]="a[i"+g+"]",v[g]="b[i"+g+"]";for(i.push("proto.transpose=function "+e+"_transpose("+h+"){"+h.map(function(r,t){return r+"=("+r+"===undefined?"+t+":"+r+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+y.join(",")+","+v.join(",")+",this.offset)}"),i.push("proto.pick=function "+e+"_pick("+h+"){var a=[],b=[],c=this.offset"),g=0;g<t;++g)i.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+a.map(function(r){return"shape["+r+"]"}).join(",")+","+a.map(function(r){return"stride["+r+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(p[r],o)}function u(r){if(n(r))return"buffer";if(i)switch(Object.prototype.toString.call(r)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(r)?"array":"generic"}var p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};t.exports=function(r,t,e,s){if(void 0===r)return(0,p.array[0])([]);"number"==typeof r&&(r=[r]),void 0===t&&(t=[r.length]);var n=t.length;if(void 0===e){e=new Array(n);for(var i=n-1,a=1;i>=0;--i)e[i]=a,a*=t[i]}if(void 0===s)for(s=0,i=0;i<n;++i)e[i]<0&&(s-=(t[i]-1)*e[i]);for(var o=u(r),c=p[o];c.length<=n+1;)c.push(h(o,c.length-1));return(0,c[n+1])(r,t,e,s)}},{"iota-array":"YG3F","is-buffer":"qZlO"}],fDKz:[function(r,t,e){"use strict";t.exports=function(r,t){switch(void 0===t&&(t=0),typeof r){case"number":if(r>0)return function(r,t){var e,s;for(e=new Array(r),s=0;s<r;++s)e[s]=t;return e}(0|r,t);break;case"object":if("number"==typeof r.length)return function r(t,e,s){var n=0|t[s];if(n<=0)return[];var i,a=new Array(n);if(s===t.length-1)for(i=0;i<n;++i)a[i]=e;else for(i=0;i<n;++i)a[i]=r(t,e,s+1);return a}(r,t,0)}return[]}},{}],aV3o:[function(r,t,e){"use strict";t.exports=function(r,t,e){return 0===r.length?r:t?(e||r.sort(t),function(r,t){for(var e=1,s=r.length,n=r[0],i=r[0],a=1;a<s;++a)if(i=n,t(n=r[a],i)){if(a===e){e++;continue}r[e++]=n}return r.length=e,r}(r,t)):(e||r.sort(),function(r){for(var t=1,e=r.length,s=r[0],n=r[0],i=1;i<e;++i,n=s)if(n=s,(s=r[i])!==n){if(i===t){t++;continue}r[t++]=s}return r.length=t,r}(r))}},{}],XMcq:[function(r,t,e){"use strict";var s=r("uniq");function n(r,t,e){var s,n,i=r.length,a=t.arrayArgs.length,o=t.indexArgs.length>0,h=[],u=[],p=0,c=0;for(s=0;s<i;++s)u.push(["i",s,"=0"].join(""));for(n=0;n<a;++n)for(s=0;s<i;++s)c=p,p=r[s],0===s?u.push(["d",n,"s",s,"=t",n,"p",p].join("")):u.push(["d",n,"s",s,"=(t",n,"p",p,"-s",c,"*t",n,"p",c,")"].join(""));for(u.length>0&&h.push("var "+u.join(",")),s=i-1;s>=0;--s)p=r[s],h.push(["for(i",s,"=0;i",s,"<s",p,";++i",s,"){"].join(""));for(h.push(e),s=0;s<i;++s){for(c=p,p=r[s],n=0;n<a;++n)h.push(["p",n,"+=d",n,"s",s].join(""));o&&(s>0&&h.push(["index[",c,"]-=s",c].join("")),h.push(["++index[",p,"]"].join(""))),h.push("}")}return h.join("\n")}function i(r,t,e){for(var s=r.body,n=[],i=[],a=0;a<r.args.length;++a){var o=r.args[a];if(!(o.count<=0)){var h=new RegExp(o.name,"g"),u="",p=t.arrayArgs.indexOf(a);switch(t.argTypes[a]){case"offset":var c=t.offsetArgIndex.indexOf(a);p=t.offsetArgs[c].array,u="+q"+c;case"array":u="p"+p+u;var f="l"+a,l="a"+p;if(0===t.arrayBlockIndices[p])1===o.count?"generic"===e[p]?o.lvalue?(n.push(["var ",f,"=",l,".get(",u,")"].join("")),s=s.replace(h,f),i.push([l,".set(",u,",",f,")"].join(""))):s=s.replace(h,[l,".get(",u,")"].join("")):s=s.replace(h,[l,"[",u,"]"].join("")):"generic"===e[p]?(n.push(["var ",f,"=",l,".get(",u,")"].join("")),s=s.replace(h,f),o.lvalue&&i.push([l,".set(",u,",",f,")"].join(""))):(n.push(["var ",f,"=",l,"[",u,"]"].join("")),s=s.replace(h,f),o.lvalue&&i.push([l,"[",u,"]=",f].join("")));else{for(var d=[o.name],g=[u],y=0;y<Math.abs(t.arrayBlockIndices[p]);y++)d.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(y+1)+"*t"+p+"b"+y);if(h=new RegExp(d.join(""),"g"),u=g.join("+"),"generic"===e[p])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(h,[l,"[",u,"]"].join(""))}break;case"scalar":s=s.replace(h,"Y"+t.scalarArgs.indexOf(a));break;case"index":s=s.replace(h,"index");break;case"shape":s=s.replace(h,"shape")}}}return[n.join("\n"),s,i.join("\n")].join("\n").trim()}function a(r){for(var t=new Array(r.length),e=!0,s=0;s<r.length;++s){var n=r[s],i=n.match(/\d+/);i=i?i[0]:"",0===n.charAt(0)?t[s]="u"+n.charAt(1)+i:t[s]=n.charAt(0)+i,s>0&&(e=e&&t[s]===t[s-1])}return e?t[0]:t.join("")}t.exports=function(r,t){for(var e=t[1].length-Math.abs(r.arrayBlockIndices[0])|0,o=new Array(r.arrayArgs.length),h=new Array(r.arrayArgs.length),u=0;u<r.arrayArgs.length;++u)h[u]=t[2*u],o[u]=t[2*u+1];var p=[],c=[],f=[],l=[],d=[];for(u=0;u<r.arrayArgs.length;++u){r.arrayBlockIndices[u]<0?(f.push(0),l.push(e),p.push(e),c.push(e+r.arrayBlockIndices[u])):(f.push(r.arrayBlockIndices[u]),l.push(r.arrayBlockIndices[u]+e),p.push(0),c.push(r.arrayBlockIndices[u]));for(var g=[],y=0;y<o[u].length;y++)f[u]<=o[u][y]&&o[u][y]<l[u]&&g.push(o[u][y]-f[u]);d.push(g)}var v=["SS"],j=["'use strict'"],m=[];for(y=0;y<e;++y)m.push(["s",y,"=SS[",y,"]"].join(""));for(u=0;u<r.arrayArgs.length;++u){for(v.push("a"+u),v.push("t"+u),v.push("p"+u),y=0;y<e;++y)m.push(["t",u,"p",y,"=t",u,"[",f[u]+y,"]"].join(""));for(y=0;y<Math.abs(r.arrayBlockIndices[u]);++y)m.push(["t",u,"b",y,"=t",u,"[",p[u]+y,"]"].join(""))}for(u=0;u<r.scalarArgs.length;++u)v.push("Y"+u);if(r.shapeArgs.length>0&&m.push("shape=SS.slice(0)"),r.indexArgs.length>0){var b=new Array(e);for(u=0;u<e;++u)b[u]="0";m.push(["index=[",b.join(","),"]"].join(""))}for(u=0;u<r.offsetArgs.length;++u){var w=r.offsetArgs[u],A=[];for(y=0;y<w.offset.length;++y)0!==w.offset[y]&&(1===w.offset[y]?A.push(["t",w.array,"p",y].join("")):A.push([w.offset[y],"*t",w.array,"p",y].join("")));0===A.length?m.push("q"+u+"=0"):m.push(["q",u,"=",A.join("+")].join(""))}var x=s([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));for((m=m.concat(x)).length>0&&j.push("var "+m.join(",")),u=0;u<r.arrayArgs.length;++u)j.push("p"+u+"|=0");r.pre.body.length>3&&j.push(i(r.pre,r,h));var k=i(r.body,r,h),M=function(r){for(var t=0,e=r[0].length;t<e;){for(var s=1;s<r.length;++s)if(r[s][t]!==r[0][t])return t;++t}return t}(d);M<e?j.push(function(r,t,e,s){for(var i=t.length,a=e.arrayArgs.length,o=e.blockSize,h=e.indexArgs.length>0,u=[],p=0;p<a;++p)u.push(["var offset",p,"=p",p].join(""));for(p=r;p<i;++p)u.push(["for(var j"+p+"=SS[",t[p],"]|0;j",p,">0;){"].join("")),u.push(["if(j",p,"<",o,"){"].join("")),u.push(["s",t[p],"=j",p].join("")),u.push(["j",p,"=0"].join("")),u.push(["}else{s",t[p],"=",o].join("")),u.push(["j",p,"-=",o,"}"].join("")),h&&u.push(["index[",t[p],"]=j",p].join(""));for(p=0;p<a;++p){for(var c=["offset"+p],f=r;f<i;++f)c.push(["j",f,"*t",p,"p",t[f]].join(""));u.push(["p",p,"=(",c.join("+"),")"].join(""))}for(u.push(n(t,e,s)),p=r;p<i;++p)u.push("}");return u.join("\n")}(M,d[0],r,k)):j.push(n(d[0],r,k)),r.post.body.length>3&&j.push(i(r.post,r,h)),r.debug&&console.log("-----Generated cwise routine for ",t,":\n"+j.join("\n")+"\n----------");var I=[r.funcName||"unnamed","_cwise_loop_",o[0].join("s"),"m",M,a(h)].join("");return new Function(["function ",I,"(",v.join(","),"){",j.join("\n"),"} return ",I].join(""))()}},{uniq:"aV3o"}],PgdI:[function(r,t,e){"use strict";var s=r("./compile.js");t.exports=function(r){var t=["'use strict'","var CACHED={}"],e=[],n=r.funcName+"_cwise_thunk";t.push(["return function ",n,"(",r.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],o=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],h=[],u=[],p=0;p<r.arrayArgs.length;++p){var c=r.arrayArgs[p];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),i.push("t"+c),i.push("r"+c),a.push("t"+c),a.push("r"+c+".join()"),o.push("array"+c+".data"),o.push("array"+c+".stride"),o.push("array"+c+".offset|0"),p>0&&(h.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[p]))),u.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[p])+"]"))}for(r.arrayArgs.length>1&&(t.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),p=0;p<r.scalarArgs.length;++p)o.push("scalar"+r.scalarArgs[p]);return e.push(["type=[",a.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),t.push("var "+e.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",o.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(s.bind(void 0,r))}},{"./compile.js":"XMcq"}],KtT7:[function(r,t,e){"use strict";var s=r("./lib/thunk.js");function n(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}t.exports=function(r){var t=new n;t.pre=r.pre,t.body=r.body,t.post=r.post;var e=r.args.slice(0);t.argTypes=e;for(var i=0;i<e.length;++i){var a=e[i];if("array"===a||"object"==typeof a&&a.blockIndices){if(t.argTypes[i]="array",t.arrayArgs.push(i),t.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),t.shimArgs.push("array"+i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)t.scalarArgs.push(i),t.shimArgs.push("scalar"+i);else if("index"===a){if(t.indexArgs.push(i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(t.shapeArgs.push(i),i<t.pre.args.length&&t.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<t.post.args.length&&t.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+e[i]);t.argTypes[i]="offset",t.offsetArgs.push({array:a.array,offset:a.offset}),t.offsetArgIndex.push(i)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>e.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>e.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>e.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!r.printCode||!!r.debug,t.funcName=r.funcName||"cwise",t.blockSize=r.blockSize||64,s(t)}},{"./lib/thunk.js":"PgdI"}],AFCU:[function(r,t,e){"use strict";t.exports=function(r,t,e){if(Array.isArray(e)){if(e.length!==t.dimension)throw new Error("ndarray-gradient: invalid boundary conditions")}else e=s(t.dimension,"string"==typeof e?e:"clamp");if(r.dimension!==t.dimension+1)throw new Error("ndarray-gradient: output dimension must be +1 input dimension");if(r.shape[t.dimension]!==t.dimension)throw new Error("ndarray-gradient: output shape must match input shape");for(var n=0;n<t.dimension;++n)if(r.shape[n]!==t.shape[n])throw new Error("ndarray-gradient: shape mismatch");return 0===t.size?r:t.dimension<=0?(r.set(0),r):c(e)(r,t)};var s=r("dup"),n=r("cwise-compiler"),i={},a={},o={body:"",args:[],thisVars:[],localVars:[]},h=n({args:["array","array","array"],pre:o,post:o,body:{args:[{name:"out",lvalue:!0,rvalue:!1,count:1},{name:"left",lvalue:!1,rvalue:!0,count:1},{name:"right",lvalue:!1,rvalue:!0,count:1}],body:"out=0.5*(left-right)",thisVars:[],localVars:[]},funcName:"cdiff"}),u=n({args:["array"],pre:o,post:o,body:{args:[{name:"out",lvalue:!0,rvalue:!1,count:1}],body:"out=0",thisVars:[],localVars:[]},funcName:"zero"});function p(r){if(r in i)return i[r];for(var t=[],e=0;e<r;++e)t.push("out",e,"s=0.5*(inp",e,"l-inp",e,"r);");var a=["array"],h=["junk"];for(e=0;e<r;++e){a.push("array"),h.push("out"+e+"s");var u=s(r);u[e]=-1,a.push({array:0,offset:u.slice()}),u[e]=1,a.push({array:0,offset:u.slice()}),h.push("inp"+e+"l","inp"+e+"r")}return i[r]=n({args:a,pre:o,post:o,body:{body:t.join(""),args:h.map(function(r){return{name:r,lvalue:0===r.indexOf("out"),rvalue:0===r.indexOf("inp"),count:"junk"!==r|0}}),thisVars:[],localVars:[]},funcName:"fdTemplate"+r})}function c(r){var t=r.join();if(v=a[t])return v;var e=r.length,s=["function gradient(dst,src){var s=src.shape.slice();"];function n(t){for(var n=e-t.length,i=[],a=[],o=[],h=0;h<e;++h)t.indexOf(h+1)>=0?o.push("0"):t.indexOf(-(h+1))>=0?o.push("s["+h+"]-1"):(o.push("-1"),i.push("1"),a.push("s["+h+"]-2"));var u=".lo("+i.join()+").hi("+a.join()+")";if(0===i.length&&(u=""),n>0){for(s.push("if(1"),h=0;h<e;++h)t.indexOf(h+1)>=0||t.indexOf(-(h+1))>=0||s.push("&&s[",h,"]>2");for(s.push("){grad",n,"(src.pick(",o.join(),")",u),h=0;h<e;++h)t.indexOf(h+1)>=0||t.indexOf(-(h+1))>=0||s.push(",dst.pick(",o.join(),",",h,")",u);s.push(");")}for(h=0;h<t.length;++h){var p=Math.abs(t[h])-1,c="dst.pick("+o.join()+","+p+")"+u;switch(r[p]){case"clamp":var f=o.slice(),l=o.slice();t[h]<0?f[p]="s["+p+"]-2":l[p]="1",0===n?s.push("if(s[",p,"]>1){dst.set(",o.join(),",",p,",0.5*(src.get(",f.join(),")-src.get(",l.join(),")))}else{dst.set(",o.join(),",",p,",0)};"):s.push("if(s[",p,"]>1){diff(",c,",src.pick(",f.join(),")",u,",src.pick(",l.join(),")",u,");}else{zero(",c,");};");break;case"mirror":0===n?s.push("dst.set(",o.join(),",",p,",0);"):s.push("zero(",c,");");break;case"wrap":var d=o.slice(),g=o.slice();t[h]<0?(d[p]="s["+p+"]-2",g[p]="0"):(d[p]="s["+p+"]-1",g[p]="1"),0===n?s.push("if(s[",p,"]>2){dst.set(",o.join(),",",p,",0.5*(src.get(",d.join(),")-src.get(",g.join(),")))}else{dst.set(",o.join(),",",p,",0)};"):s.push("if(s[",p,"]>2){diff(",c,",src.pick(",d.join(),")",u,",src.pick(",g.join(),")",u,");}else{zero(",c,");};");break;default:throw new Error("ndarray-gradient: Invalid boundary condition")}}n>0&&s.push("};")}for(var o=0;o<1<<e;++o){for(var c=[],f=0;f<e;++f)o&1<<f&&c.push(f+1);for(var l=0;l<1<<c.length;++l){var d=c.slice();for(f=0;f<c.length;++f)l&1<<f&&(d[f]=-d[f]);n(d)}}s.push("return dst;};return gradient");var g=["diff","zero"],y=[h,u];for(o=1;o<=e;++o)g.push("grad"+o),y.push(p(o));g.push(s.join(""));var v=Function.apply(void 0,g).apply(void 0,y);return i[t]=v,v}},{dup:"fDKz","cwise-compiler":"KtT7"}],R2G5:[function(r,t,e){"use strict";var s=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0});var n=s(r("./quad")),i=s(r("@talenfisher/dtype")),a=s(r("ndarray")),o=s(r("ndarray-gradient")),h=1e-4,u=5,p=.1,c=function(){function r(r){this.vertexCount=0,this.elementCount=0,this.axes=[],this.lo=[1/0,1/0,1/0],this.hi=[-1/0,-1/0,-1/0],this.missingFactor=0,this.pointBuffer=r.pointBuffer,this.origin=r.origin,this.decimationFactor=r.decimationFactor||0,this.axes=[r.axes.x,r.axes.y,r.axes.z],this.shape=[this.axes[0].size,this.axes[1].size,3],this.missingFactorUnit=1/(this.shape[0]*this.shape[1]),this.dataLength=this.shape[0]*this.shape[1]*this.shape[2],this.coords=a.default(new Float32Array(this.dataLength),this.shape),this.padStop=[0,0],this.padStart=[this.shape[0],this.shape[1]];var t=this.axes[2].dataType.name||"d",e=i.default(t);if(!e)throw new Error("Could not find data type '"+e+"'");var s=new e(this.pointBuffer),n=this.axes[0].increment/h,o=this.axes[1].increment/h,c=this.origin[1].toLowerCase(),f=this.origin[0].toLowerCase(),l="e"===c?0:this.shape[0],d="n"===f?0:this.shape[1];this.lo=[0,0,1/0],this.hi=[this.shape[0]*n,this.shape[1]*o,-1/0];for(var g=-1,y=[!1,!1],v=[!1,!1],j=Object.assign([],this.shape),m=0;m<s.length;m++){for(var b=m%this.shape[0],w=(0===b?++g:g)%this.shape[1],A=[b,w],x=0;x<2;x++)0===A[1^x]&&(y[1^x]=!1,v[x]=!1,this.padStart[x]=(this.padStart[x]+j[x])/2,j[x]=this.shape[x]);var k=Math.abs(l-b)*n,M=Math.abs(d-w)*o,I=s[m]/h*u;if(this.coords.set(b,w,0,k),this.coords.set(b,w,1,M),this.coords.set(b,w,2,I),!isNaN(s[m])&&isFinite(s[m])&&(this.lo[2]=Math.min(this.lo[2],s[m]),this.hi[2]=Math.max(this.hi[2],s[m])),isNaN(s[m])&&this.getDistanceToEdge(b,w)>p&&(this.missingFactor+=this.missingFactorUnit),!isNaN(s[m]))for(x=0;x<2;x++)y[x]||(y[x]=!0,this.padStop[x]=(this.padStop[x]+A[x])/2),j[x]=A[x]}for(m=0;m<2;m++)this.padStop[m]=Math.min(this.padStop[m],this.shape[m]*p),this.padStart[m]=Math.max(this.padStart[m],this.shape[m]*(1-p));var _=0;for(m=0;m<2;m++){var F=1^m;_+=this.missingFactorUnit*this.shape[F]*this.padStop[m],_+=this.missingFactorUnit*this.shape[F]*(this.shape[m]-this.padStart[m])}console.log("padding: "+_),console.log("missing: "+this.missingFactor),console.log("size: "+this.shape),this.missingFactor=Math.max(this.missingFactor-_,0),this.buffer()}return r.prototype.setupGradient=function(){var r=[3,this.shape[0],this.shape[1],2],t=this.coords;this.gradient=a.default(new Float32Array(2*this.dataLength),r);for(var e=0;e<3;e++)o.default(this.gradient.pick(e),t.pick(null,null,e))},r.prototype.getDistanceToEdge=function(r,t){var e=Math.ceil(this.shape[0]/2),s=Math.ceil(this.shape[1]/2),n=Math.abs(r-e)/this.shape[0],i=Math.abs(t-s)/this.shape[1];return Math.min(n,i)},r.prototype.getNormal=function(r,t){if(this.gradient){var e=this.gradient.get(0,r,t,0),s=this.gradient.get(0,r,t,1),n=this.gradient.get(1,r,t,0),i=this.gradient.get(1,r,t,1),a=this.gradient.get(2,r,t,0),o=this.gradient.get(2,r,t,1),h=n*o-i*a,u=a*s-o*e,p=e*i-s*n,c=Math.sqrt(Math.pow(h,2)+Math.pow(u,2)+Math.pow(p,2));return c<1e-8?(c=Math.max(Math.abs(h),Math.abs(u),Math.abs(p)))<1e-8?(p=1,u=h=0,c=1):c=1/c:c=1/Math.sqrt(c),[h*c,u*c,p*c]}},r.prototype.buffer=function(){var r=this.stride,t=this.coords,e=n.default(r),s=0,i=this.shape[0]-r,a=this.shape[1]-r,o=e.length,h=i*a*o*8;this.setupGradient(),this.elementCount=0,this.vertexCount=0,this.coordBuffer=new Float32Array(h);for(var u=0;u<i;u+=r){r:for(var p=0;p<a;p+=r){for(var c=0;c<=r;c++)for(var f=0;f<=r;f++){var l=t.get(1+u+c,1+p+f,2);if(isNaN(l)||!isFinite(l))continue r}for(var d=u/this.shape[0],g=p/this.shape[1],y=0;y<o;y++){var v=u+e[y][0],j=p+e[y][1];this.coordBuffer[s++]=t.get(v,j,0),this.coordBuffer[s++]=t.get(v,j,1),this.coordBuffer[s++]=t.get(v,j,2);var m=this.getNormal(v,j);this.coordBuffer[s++]=m[0],this.coordBuffer[s++]=m[1],this.coordBuffer[s++]=m[2],this.coordBuffer[s++]=d,this.coordBuffer[s++]=g,this.vertexCount++}}postMessage({progress:u/this.shape[0]})}this.elementCount=s},Object.defineProperty(r.prototype,"result",{get:function(){var r=this.coords;return{vertexCount:this.vertexCount,elementCount:this.elementCount,buffer:this.coordBuffer,shape:[r.shape[0],r.shape[1]],bounds:[this.lo,this.hi],missingFactor:this.missingFactor}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stride",{get:function(){var r=this.decimationFactor;r=Math.max(0,r),r=Math.min(r,1);var t=this.coords.shape,e=(t[0]+t[1])/2,s=Math.floor(e/200);return 1+Math.floor(r*s)},enumerable:!0,configurable:!0}),r}();onmessage=function(r){var t=new c(r.data).result,e=Object.assign({progress:1},t),s=[t.buffer.buffer];postMessage(e,s),close()}},{"./quad":"gm1b","@talenfisher/dtype":"oQJj",ndarray:"cMKA","ndarray-gradient":"AFCU"}]},{},["R2G5"]);
},{}]},{},["Ofed"], null)